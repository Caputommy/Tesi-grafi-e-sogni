\chapter{Procedure di Contrazione}\label{cap:proc_contr}

In questo capitolo si entrerà nel merito delle dinamiche interne alla costruzione della struttura di un grafo
multi-livello e alle sue funzioni di contrazione.
Sebbene nel Capitolo~\ref{ch:algoritmi-di-enumerazione} si siano già stati illustrati gli
algoritmi specifici per il riconoscimento e l'elencazione di pattern strutturali all'interno di un grafo,
nulla è stato ancora detto di come queste procedure di enumerazione debbano essere sfruttate nel contesto più
complesso del grafo multi-livello.
In particolare, si vuole dare una visione più chiara di come sia algoritmicamente
possibile realizzare una rete di collegamenti tra supernodi su più livelli attenendosi alle definizioni
fornite nel Capitolo~\ref{cap:grafi-multi-livello}, affinché si possa ottenere un tale risultato a partire da una
qualsiasi sequenza di insiemi di nodi generati dalle procedure di enumerazione, evidenziandone problematiche e
possibili soluzioni.

\section{Riduzione disgiunta}

Si vuole ora considerare il generico problema per cui, dato un grafo decontraibile $G = (V, E)$ e un insieme di
sottoinsiemi di nodi $Q \subseteq \mathcal{P}(V)$ che costituisce una copertura di $V$, si vuole costruire un grafo
decontraibile $G'$ che rappresenti l'informazione fornita dal raggruppamento dei nodi descritto in $Q$.
Aspetto di fondamentale importanza è che l'insieme $Q$ non costituisce necessariamente una partizione.
$Q$ potrebbe quindi essere calcolato a partire da un grafo $G$ attraverso un algoritmo di enumerazione, in modo tale
che i suoi elementi siano insiemi di nodi appartenenti ad un certo pattern strutturale.
Tuttavia, come si può immaginare, tali insiemi non sono necessariamente disgiunti: basti pensare alle cricche e i
circuiti semplici, che possono avere nodi in intersezioni di più insiemi.
Le componenti fortemente connesse invece, essendo costruite a partire da una relazione di equivalenza, sono un
valido esempio di pattern strutturale che costituisce sempre una partizione di $V$. \newline

D'ora in avanti, ci riferiremo agli elementi di una tale copertura di nodi $Q$ (non necessariamente disgiunta)
come \textbf{insiemi componenti} \newline

Per mantenere le proprietà delle contrazioni su grafi è però necessario che ad ogni nodo corrisponda ad uno ed un solo
supernodo.
La presenza dello stesso nodo in più supernodi contratti non sarebbe coerente con la teoria dei grafi
già affermata, oltre che portare ad un risultato che rischia di avere limitate applicabilità.
Si vuole quindi definire una procedura per rappresentare l'informazione fornita da $Q$ in un nuovo insieme che sia una
partizione di $V$ rappresentativa di $Q$ e, a partire da questa, costruire un grafo decontraibile $G'$.
Abbinare questa definzione generica, valida nella teoria degli insiemi, ad uno specifico algoritmo per calcolare
$Q$ a partire dalla struttura di un grafo, è il primo passo che permetterà di definire particolari funzioni di
contrazione.

\subsection{Definzione}

\begin{definition}[Riduzione disgiunta]
Sia $V$ un insieme di elementi. Sia $Q \subseteq \mathcal{P}(V)$ una copertura di $V$.
Definiamo la \textbf{riduzione disgiunta} di $Q$, e la indichiamo con $\mathcal{D}(Q)$,
l'insieme di insiemi di elementi in $V$ tale per cui:
\begin{enumerate}[(i)]
    \item $\emptyset \notin \mathcal{D}(Q)$
    \item $\forall A \in \mathcal{D}(Q), \quad u, v \in A \Leftrightarrow \{C \in Q \mid u \in C\} = \{C \in Q \mid v \in C\}$
\end{enumerate}
\end{definition}

Una riduzione disgiunta di una copertura $Q$ è quindi un insieme di insiemi di nodi in $V$ tale per cui due
nodi $u$ e $v$ appartengono allo stesso insieme in $\mathcal{D}(Q)$ se e solo se sono inclusi nella stessa combinazione
di insiemi in $Q$. \newline

\begin{figure}[!h] \centering
\include{TikzPictures/disjoint_reduction_example}
\caption{Esempio di riduzione disgiunta}
\label{fig:disjoint_reduction_example}
\end{figure}

L'esempio in Figura~\ref{fig:disjoint_reduction_example} fornisce una rappresentazione di una copertura $Q$ di
elementi (a sinistra) accompagnata dalla sua riduzione disgiunta $D(Q)$ (a destra).

Il nome di questa definizione deriva dal fatto che:
\begin{itemize}
    \item il risultato di questo operatore su una copertura $Q$, da solo non contiene le informazioni sufficienti a
        descrivere la copertura che lo ha originato, che potrebbero essere molteplici (ma non infinite, se si ha a che
        fare con insiemi finiti). %TODO: nota: potrebbe essere una classe di equivalenza tra coperture!!
        Da qui il termine \("\)riduzione\("\).
    \item il risultato di questo operatore su una copertura $Q$ di $V$ costituisce una partizione di $V$, come
        dimostrato in seguito, e fornisce un criterio per una suddivisione degli elementi in $V$ in insiemi disgiunti
        tra loro.
        Da qui il termine \("\)disgiunta\("\).
\end{itemize}

\begin{proposition}
Sia $V$ un insieme di elementi. Sia $Q \subseteq \mathcal{P}(V)$ una copertura di $V$.
La riduzione disgiunta di $Q$ costituisce una partizione di $V$.
\end{proposition}

\paragraph{Dimostrazione}
Si definisce la relazione $R_Q$ sull'insieme $V$ come
\begin{equation*}
    uR_{Q}v \Leftrightarrow \{C \in Q \mid u \in C\} = \{C \in Q \mid v \in C\}
\end{equation*}

Essa \`e una relazione di equivalenza, in quanto rispetta le propriet\`a di riflessivit\`a, simmetria e transitivit\`a,
che sono date dalle rispettive propriet\`a dell'uguaglianza.
Segue che l'insieme quoziente $V/R_{Q}$ deve rappresentare una partizione degli elementi in $V$.

Per il punto (ii) della definzione di $\mathcal{D}(Q)$, i suoi insiemi non vuoti rappresentano le classi di equivalenza
di $R_Q$.
Inoltre per il punto (i), l'insieme vuoto non pu\`o appartenere a $D(Q)$.
Si conclude allora $D(Q) = V/R_{Q}$, e pertanto $D(Q)$ \`e una partizione di $V$.

\nlparagraph{Definizione tramite ipergrafi}
Un \text{ipergrafo} è una struttura simile ad un grafo non orientato dove ogni arco, detto \textit{iperarco},
anziché collegare una semplice coppia di nodi può connettere un arbitrario sottoinsieme di vertici.
Più formalmente, un ipergrafo $H$ è una coppia $(X, E)$ dove $X$ è un insieme di elementi chiamati nodi ed $E$ è
un insieme di sottoinsiemi di $X$ chiamati iperarchi.
Si consideri ora un ipergrafo non orientato $H = (X, E)$.
Notando che un iperarco non orientato $e \in E$ è a tutti gli effetti un insieme di nodi $e \subseteq V$,
si pu\`o estendere il concetto di rappresentazione disgiunta anche nel dominio degli ipergrafi.

\begin{definition}[Riduzione disgiunta di un ipergrafo]
    Dato un ipergrafo non orientato $H = (X, E)$ tale per cui $E$ \`e un ricoprimento di $X$,
    definiamo \textbf{riduzione disgiunta} di $H$ un nuovo ipergrafo non orientato $J = (W, F)$
    tale per cui $W = V$ e $F = \mathcal{D}(E)$.
\end{definition}

Si pu\`o notare, quindi, che la funzione di riduzione disgiunta pu\`o essere considerata come una
endofunzione idempotente sull'insieme degli ipergrafi non orientati.

\nlparagraph{Contrazione costruita da una partizione}
Motivo per cui la riduzione disgiunta di una copertura è certamente utile nel momento in cui si voglia
realizzare una funzione di contrazione, è che essa permette di ottenere una partizione di nodi.
La seguente ulteriore definizione permette di chiarire il passaggio che porta alla produzione in output di un grafo
decontraibile.

\begin{definition}[Contrazione costruita da una partizione]
Sia $G = (V, E)$ un grafo decontraibile, sia $P$ una partizione di $V$.
Si definisce \textbf{contrazione di $G$ costruita sulla partizione $P$} il grafo decontraibile
$G' = (\mathfrak{V}, \mathfrak{E})$ contrazione di $G$ tale per cui
    \begin{equation*}
        \{V_\alpha \mid \alpha \in \mathfrak{V}, dec_{\mathfrak{V}}(\alpha) = (V_\alpha, E_\alpha)\} = P
    \end{equation*}
\end{definition}

Dato un grafo decontraibile $G$ e una sua partizione dei nodi, quindi, è sempre possibile calcolare la sua
contrazione $G'$ contraendo nodi di $G$ in supernodi di $G'$ secondo gli insiemi descritti dalla partizione.
Si noti, infatti, che esiste una biiezione tra l'insieme delle possibili contrazioni di $G$ e l'insieme delle
partizioni di $V$ e che, pertanto, data una partizione di $V$ esiste una ed una sola contrazione di $G$ costruita
su di essa.

\subsection{Algoritmo per la contrazione costruita da una riduzione disgiunta}\label{sec:make_decontractible_graph}
Entrambi i concetti esposti nel paragrafo precedente, ovvero la riduzione disgiunta di una copertura e la
contrazione costruita da una partizione, sono considerabili come elementi sufficientemente generici
per la definizione di una qualsiasi procedura di contrazione.
In particolare, il passaggio da una copertura
di nodi ad un grafo decontraibile può essere considerato come l'operazione successiva all'enumerazione degli
insiemi di nodi che costituiscono la copertura stessa. \newline

Risulta quindi utile definire un algoritmo che a partire da un grafo decontraibile $G$ e una sua copertura $Q$,
fornisca in output la contrazione di $G$ costruita sulla riduzione disgiunta di $Q$.

Una delle possibili rappresentazioni della copertura $Q$, da fornire in input a tale algoritmo, è quella un
\textit{dizionario} (talvolta anche detto ``mappa'' o ``tabella''), una struttura dati astratta che rappresenta una
collezione di coppie di elementi chiave-valore e le cui operazioni fondamentali consistono nell'inserimento e
cancellazione di coppie e ricerca di un valore mediante la sua chiave. \`E importante che in un dizionario
ad ogni chiave corrisponda al più un solo valore.
Negli pseudocodici, dato un dizionario $T$, l'operazione di ricerca di un valore associato ad una chiave $k$ verrà
indicata con $T[k]$, mentre l'operazione di inserimento di una coppia chiave-valore $(k, v)$ con $T[k] = v$.
Con $T.keys$ e $T.values$ si indicano rispettivamente l'insieme delle chiavi e l'insieme dei valori contenuti in $T$.

La copertura $Q$ è quindi data da un dizionario $T$ di dimensione $|V|$, in cui le coppie chiave-valore consistono di:
\begin{itemize}
    \item Chiave: nodo $v \in V$
    \item Valore: l'insieme di insiemi componenti $C \in Q$ tali per cui $v \in C$
\end{itemize}

Nel corso dell'algoritmo un altro dizionario $T'$ viene usato allo scopo di mappare la biiezione tra gli elementi
di $\mathcal{D}(Q)$ (quindi le classi di equivalenza di $V/R_Q$) e i supernodi di $G'$.
Aggiungendo coppie a $T'$, naturalmente al termine dell'algoritmo il dizionario $T'$ dovrà raggiungere la dimensione
$|\mathcal{D}(Q)|$. \newline

Nel ciclo a riga 3, si assegna ogni nodo del grafo decontaibile in input $G$ ad un supernodo, che esso sia
creato contestualmente o che sia il supernodo già creato corrispondente all'insieme di insiemi componenti in $v$.
Essendo che le precondizioni impongono che $T$ rappresenti una copertura di $V$, l'insieme $G.V$ a riga 3
potrebbe essere sostituito con $T.keys$.
Nel ciclo a riga 15, si assegnano gli archi di $G$ ai superarchi di $G'$. Se l'arco $(v, w)$ è interno ad un
supernodo, esso viene assegnato al suo insieme di archi. Se invece l'arco è tra collega due supernodi distinti, esso
viene assegnato al superarco corrispondente, che potrebbe essere contestualmente creato.

\input{Algoritmi/3-make_decontractible_graph}

In Figura~\ref{fig:make_decontractible_graph_example} sono rappresentati il grafo $G$, suddiviso in due insiemi
componenente e il corrispondente dizionario $T$ che ne rappresenta la copertura. Il dizionario $T\mathcal{'}$ \`e
rappresentato nello stato seguente all'applicazione dell'algoritmo MAKE-DECONTRACTIBLE-GRAPH con input $T$ e $G$,
contenendo come insieme di valori i supernodi ottenuti dalla contrazione di $G$.
Il risultato di MAKE-DECONTRACTIBLE-GRAPH($T$, $G$) \`e in questo caso il grafo decontraibile
$G'=(\{\alpha_1, \alpha_2, \alpha_3\}, \{(\alpha_1, \alpha_2), (\alpha_2, \alpha_3)\})$

\begin{figure}[H]
    \centering
    \include{TikzPictures/make_dec_graph_example}
    \vspace{-30pt}
    \caption{Esempio di tabelle $T$ e $T'$ e del corrispondente grafo decontraibile}
    \label{fig:make_decontractible_graph_example}
\end{figure}

\paragraph{Complessità}
Facendo uso di tabelle di hash per rappresentare i dizionari $T$ e $T'$, l'algoritmo mantiene una complessit\`a
temporale di $O(|V| + |E|)$.
Si noti infatti che:
\begin{itemize}
    \item Il primo ciclo for scorre tutti i nodi in $V$.
    Esso inizializza il dizionario $T'$, definisce i supernodi di $G'$ e assegna loro i nodi in $V$.
    La complessità del ciclo è $O(|V|)$, infatti il controllo a riga 3 ha complessità costante,
    così come le ricerca in $T$ e $T'$ alle righe 7 e 10.
    \item Il secondo ciclo for scorre tutti gli archi in $E$.
    Esso assegna gli archi di $G$ ai grafi dei supernodi di $G'$ o ai superarchi di $G'$ a seconda dei supernodi
    di appartenenza dei nodi che li compongono, ottenibili in tempo $O(1)$ in quanto precedentemente calcolati nel
    primo ciclo for. La complessit\`a del ciclo \`e $O(|E|)$.
\end{itemize}